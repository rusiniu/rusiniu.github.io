<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>title</title>
    <script>
        //–ü–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã get
        function getURLVarArr() {
            var data = [];
            var query = String(document.location.search).split('?');
            if (query[1]) {
                var part = query[1].split('&');
                for (i = 0; i < part.length; i++) {
                var dat = part[i].split('=');
                data[dat[0]] = dat[1];
                }
            }
            return data;
        }

        //–û–±—Ä–∞—â–∞–µ–º—Å—è –∫ api
        async function call_nearblocks (method, account) {
            const server_nearblocks = "https://api.nearblocks.io";
            var url = server_nearblocks + "/v1/account/" +account + "/" + method;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error("Error");
                const data = await response.json();
                //console.log(data);
                return data;
            } catch (error) {
                console.log("–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞: ", error.message);
            }
        }

        //
        async function build_table() {
            //–ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ get
            let get_vars = getURLVarArr();
            var method = 'ft-txns';
            trx_list = await call_nearblocks(method, get_vars["wallet"]);

            const txTable = document.querySelector("#trxList tbody");
            txTable.innerHTML = '';
            //–ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ –∏ –≥–æ–≤–æ—Ä–∏–º
            if (trx_list.txns === undefined) {
                txTable.innerHTML = "<tr><td colspan='4'>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>";
                return;
            }
            await trx_list.txns.forEach(function(tx) {
                const row = document.createElement("tr");
                //–ò–∑ —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É
                tx_date =  new Date(tx.block_timestamp /1000000);
                row.innerHTML = 
                    '<td>' + tx_date.getFullYear() + "-" + tx_date.getMonth() + "-" + tx_date.getDate() + " " + ("0" + tx_date.getHours()).slice(-2) + ":" + ("0" +tx_date.getMinutes()).slice(-2) + ":" + ("0" + tx_date.getSeconds()).slice(-2)  + '</td>\n' +
                    '<td><p><abbr title="' + tx.ft.name + '"><img class="icon" src="' +  tx.ft.icon + '" alt="' + tx.ft.name + '" /></abbr></p></td>\n' +
                    '<td>' + tx.delta_amount / Math.pow(10,  tx.ft.decimals) + '</td>\n';
                    //–ú–∏–Ω—Ç        
                    if(tx.cause == "MINT") row.innerHTML += '<td>‚ú® mint</td>'
                    
                    else if (tx.delta_amount < 0){
                        //–ò—Å—Ö–æ–¥—è—â–∏–µ
                        row.innerHTML +='<td>üì§ ' + tx.involved_account_id + '</td>' ;
                    } else {
                        //–í—Ö–æ–¥—è—â–∏–µ
                        row.innerHTML +='<td>üì• ' + tx.involved_account_id + '</td>' ;
                    }
                    row.innerHTML += '</td>\n';
                        //console.log(tx)
                    txTable.appendChild(row);
            } );
        } 
    </script>
    <style>
        .icon {
            width: 2em;
            
        }
        body {
            padding-bottom: 0;
        }
    </style>

</head>
<body>
    <script>
        //–ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–≥–æ
        document.addEventListener("DOMContentLoaded", async () => {
            build_table() ; // –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        });
    </script>

<div class="container">
    <main>
        <table class="table table-hover table-sm" id="trxList">
            <thead>
                <tr>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–¢–æ–∫–µ–Ω</th>
                    <th>–û–±—ä–µ–º</th>
                    <th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                <!-- –°—Ç—Ä–æ–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
            </tbody>
        </table>
    </main>
</div>
<!--
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
-->

</body>
</html>