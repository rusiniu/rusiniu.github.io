<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä—ã–Ω–∫–∞ Caps Game</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f2f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .filters { margin: 20px 0; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .filters select, .filters input, .filters button { margin: 0 10px 10px 0; padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; }
        .filters button { background: #007bff; color: white; border: none; cursor: pointer; }
        .filters button:hover { background: #0056b3; }
        .filters button:disabled { background: #6c757d; cursor: not-allowed; }
        .sort-option { display: flex; align-items: center; margin: 10px 0; }
        .sort-option input { margin-right: 8px; }
        .stats { margin: 20px 0; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .item-list { max-height: 600px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: white; border-radius: 5px; }
        .item { padding: 12px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; }
        .item:hover { background: #f8f9fa; }
        .item-image { width: 50px; height: 50px; object-fit: contain; border-radius: 5px; border: 1px solid #ddd; }
        .item-info { flex: 1; }
        .item-price { font-weight: bold; color: #28a745; font-size: 16px; min-width: 100px; text-align: right; }
        .item-collection { font-weight: bold; color: #333; }
        .item-quality { color: #6c757d; font-size: 14px; }
        .item-id { color: #999; font-size: 12px; }
        .chart-container { margin: 20px 0; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .loading { color: #666; font-style: italic; text-align: center; padding: 20px; }
        .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 5px; }
        .success { color: #155724; background: #d4edda; padding: 10px; border-radius: 5px; }
        .collection-info { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .status-badge { padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .status-available { background: #d4edda; color: #155724; }
        .status-sold-out { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä—ã–Ω–∫–∞ Caps Game</h1>
        
        <div class="filters">
            <h3>–§–∏–ª—å—Ç—Ä—ã:</h3>
            <div class="collection-info">
                <select id="collectionSelect">
                    <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π...</option>
                </select>
                <span id="collectionStats" class="loading"></span>
            </div>
            
            <select id="qualitySelect">
                <option value="">–í—Å–µ –∫–∞—á–µ—Å—Ç–≤–∞</option>
                <option value="COMMON">COMMON</option>
                <option value="COMMON_PLUS">COMMON_PLUS</option>
                <option value="RARE">RARE</option>
                <option value="RARE_PLUS">RARE_PLUS</option>
                <option value="EPIC">EPIC</option>
                <option value="EPIC_PLUS">EPIC_PLUS</option>
                <option value="LEGEND">LEGEND</option>
                <option value="LEGEND_PLUS">LEGEND_PLUS</option>
                <option value="DIAMOND">DIAMOND</option>
            </select>
            
            <input type="number" id="limitInput" placeholder="–õ–∏–º–∏—Ç" value="100" min="1" max="1000">
            
            <div class="sort-option">
                <input type="checkbox" id="sortByNumber" onchange="loadMarketData()">
                <label for="sortByNumber">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –Ω–æ–º–µ—Ä—É (–≤–º–µ—Å—Ç–æ —Ü–µ–Ω—ã)</label>
            </div>
            
            <button onclick="loadMarketData()" id="loadBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>

        <div class="stats" id="stats">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>
        </div>

        <div class="chart-container">
            <canvas id="priceChart" width="400" height="200"></canvas>
        </div>

        <div>
            <h3>–°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:</h3>
            <div class="item-list" id="itemList">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞</div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const FIRESTORE_URL = "https://firestore.googleapis.com/v1/projects/capsgame-prod/databases/(default)/documents:runQuery";
        const COLLECTIONS_URL = "https://firestore.googleapis.com/v1/projects/capsgame-prod/databases/(default)/documents/Static/CapsCollections";
        const STORAGE_BASE_URL = "https://firebasestorage.googleapis.com/v0/b/capsgame-prod.appspot.com/o/";
        
        let currentChart = null;
        let collections = [];

        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Firestore fields
        function getFieldValue(fields, fieldName, defaultValue = null) {
            if (!fields || !fields[fieldName]) {
                return defaultValue;
            }
            
            const field = fields[fieldName];
            if (field.stringValue !== undefined) return field.stringValue;
            if (field.integerValue !== undefined) return parseInt(field.integerValue);
            if (field.doubleValue !== undefined) return parseFloat(field.doubleValue);
            if (field.booleanValue !== undefined) return field.booleanValue;
            
            return defaultValue;
        }

        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        async function loadCollections() {
            try {
                showMessage('collectionSelect', '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π...', 'loading');
                document.getElementById('collectionStats').textContent = '';
                
                const response = await fetch(COLLECTIONS_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                collections = parseCollectionsResponse(data);
                
                populateCollectionSelect(collections);
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–æ–ª–ª–µ–∫—Ü–∏–π:', collections.length);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π:', error);
                showMessage('collectionSelect', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π', 'error');
            }
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
        function parseCollectionsResponse(response) {
            if (!response.fields || !response.fields.collections || !response.fields.collections.arrayValue) {
                console.error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:', response);
                return [];
            }

            return response.fields.collections.arrayValue.values
                .map(item => {
                    try {
                        const fields = item.mapValue.fields;
                        return {
                            id: getFieldValue(fields, 'id', 'unknown'),
                            title: getFieldValue(fields, 'title', 'Unknown Collection'),
                            status: getFieldValue(fields, 'status', 'unknown'),
                            supply: getFieldValue(fields, 'supply', 0),
                            used: getFieldValue(fields, 'used', 0),
                            burned: getFieldValue(fields, 'burned', 0),
                            size: getFieldValue(fields, 'size', 0),
                            isStandard: getFieldValue(fields, 'isStandard', false),
                            isCommunity: getFieldValue(fields, 'isCommunity', false),
                            hasCustomDiamond: getFieldValue(fields, 'hasCustomDiamond', false),
                            order: getFieldValue(fields, 'order', 0)
                        };
                    } catch (error) {
                        console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏:', error, item);
                        return null;
                    }
                })
                .filter(collection => collection !== null && collection.id !== 'unknown')
                .sort((a, b) => {
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–≤—ã–º–∏
                    if (a.status === 'available' && b.status !== 'available') return -1;
                    if (a.status !== 'available' && b.status === 'available') return 1;
                    return (a.order || 0) - (b.order || 0);
                });
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        function populateCollectionSelect(collections) {
            const select = document.getElementById('collectionSelect');
            select.innerHTML = '<option value="">–í—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</option>';
            
            collections.forEach(collection => {
                const option = document.createElement('option');
                option.value = collection.id;
                option.textContent = `${collection.title} (${collection.status === 'available' ? '‚úÖ' : '‚ùå'} ${collection.size}—à—Ç)`;
                option.title = `Supply: ${collection.supply.toLocaleString()} | Used: ${collection.used.toLocaleString()} | Burned: ${collection.burned.toLocaleString()}`;
                select.appendChild(option);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏
            select.addEventListener('change', updateCollectionInfo);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function updateCollectionInfo() {
            const selectedId = document.getElementById('collectionSelect').value;
            const collection = collections.find(c => c.id === selectedId);
            const statsElement = document.getElementById('collectionStats');
            
            if (collection) {
                const availablePercent = collection.supply > 0 ? ((collection.supply - collection.used) / collection.supply * 100).toFixed(1) : 0;
                const burnedPercent = collection.supply > 0 ? (collection.burned / collection.supply * 100).toFixed(1) : 0;
                
                statsElement.innerHTML = `
                    <span class="status-badge ${collection.status === 'available' ? 'status-available' : 'status-sold-out'}">
                        ${collection.status === 'available' ? '–î–û–°–¢–£–ü–ù–ê' : '–ü–†–û–î–ê–ù–ê'}
                    </span>
                    Supply: ${collection.supply.toLocaleString()} | 
                    Available: ${(collection.supply - collection.used).toLocaleString()} (${availablePercent}%) |
                    Burned: ${collection.burned.toLocaleString()} (${burnedPercent}%) |
                    Size: ${collection.size}
                `;
            } else {
                statsElement.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';
            }
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function loadMarketData() {
            const collection = document.getElementById('collectionSelect').value;
            const quality = document.getElementById('qualitySelect').value;
            const limit = parseInt(document.getElementById('limitInput').value) || 100;
            const sortByNumber = document.getElementById('sortByNumber').checked;

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
            const loadBtn = document.getElementById('loadBtn');
            loadBtn.disabled = true;
            loadBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            showLoading();
            
            try {
                const items = await fetchMarketData(collection, quality, limit, sortByNumber);
                displayStats(items);
                displayItems(items);
                updateChart(items);
                
                document.getElementById('stats').classList.remove('error');
                document.getElementById('stats').classList.add('success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                document.getElementById('stats').innerHTML = `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
                document.getElementById('stats').classList.remove('success');
                document.getElementById('stats').classList.add('error');
            } finally {
                loadBtn.disabled = false;
                loadBtn.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ';
            }
        }

        // –ó–∞–ø—Ä–æ—Å –∫ Firestore API
        async function fetchMarketData(collection, quality, limit, sortByNumber) {
            const whereFilters = [{
                "fieldFilter": {
                    "field": {"fieldPath": "status"},
                    "op": "EQUAL",
                    "value": {"stringValue": "SALE"}
                }
            }];

            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã
            if (collection) {
                whereFilters.push({
                    "fieldFilter": {
                        "field": {"fieldPath": "collectionId"},
                        "op": "EQUAL", 
                        "value": {"stringValue": collection}
                    }
                });
            }

            if (quality) {
                whereFilters.push({
                    "fieldFilter": {
                        "field": {"fieldPath": "grade"},
                        "op": "EQUAL",
                        "value": {"stringValue": quality}
                    }
                });
            }

            const where = whereFilters.length === 1 ? 
                whereFilters[0] : 
                {
                    "compositeFilter": {
                        "op": "AND",
                        "filters": whereFilters
                    }
                };

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
            const orderBy = sortByNumber ? 
                [{
                    "field": {"fieldPath": "number"},
                    "direction": "ASCENDING"
                }] :
                [{
                    "field": {"fieldPath": "price"},
                    "direction": "ASCENDING"
                }];

            const query = {
                "structuredQuery": {
                    "from": [{"collectionId": "Caps"}],
                    "where": where,
                    "orderBy": orderBy,
                    "limit": limit
                }
            };

            const response = await fetch(FIRESTORE_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(query)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            return parseFirestoreResponse(data);
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ Firestore
        function parseFirestoreResponse(response) {
            return response
                .filter(item => item.document)
                .map(item => {
                    const fields = item.document.fields;
                    const imageUrl = getFieldValue(fields, 'url');
                    const fullImageUrl = imageUrl ? `${STORAGE_BASE_URL}${encodeURIComponent(imageUrl)}?alt=media` : null;
                    
                    return {
                        id: item.document.name.split('/').pop(),
                        collection: getFieldValue(fields, 'collection', 'Unknown'),
                        quality: getFieldValue(fields, 'grade', 'UNKNOWN'), 
                        price: getFieldValue(fields, 'price', 0) / 1000000000,
                        itemId: getFieldValue(fields, 'number', 'Unknown'),
                        imageUrl: fullImageUrl,
                        timestamp: new Date().toLocaleString()
                    };
                });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function displayStats(items) {
            if (items.length === 0) {
                document.getElementById('stats').innerHTML = '<div>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                return;
            }

            const prices = items.map(item => item.price);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const avgPrice = (prices.reduce((a, b) => a + b, 0) / prices.length).toFixed(2);
            const totalValue = prices.reduce((a, b) => a + b, 0);

            // –ù–∞—Ö–æ–¥–∏–º –º–µ–¥–∏–∞–Ω—É
            const sortedPrices = [...prices].sort((a, b) => a - b);
            const medianPrice = sortedPrices.length % 2 === 0 
                ? (sortedPrices[sortedPrices.length/2 - 1] + sortedPrices[sortedPrices.length/2]) / 2
                : sortedPrices[Math.floor(sortedPrices.length/2)];

            document.getElementById('stats').innerHTML = `
                <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä—ã–Ω–∫–∞:</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div><strong>–ù–∞–π–¥–µ–Ω–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:</strong> ${items.length}</div>
                    <div><strong>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</strong> ${minPrice.toFixed(2)}</div>
                    <div><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</strong> ${maxPrice.toFixed(2)}</div>
                    <div><strong>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:</strong> ${avgPrice}</div>
                    <div><strong>–ú–µ–¥–∏–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞:</strong> ${medianPrice.toFixed(2)}</div>
                    <div><strong>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ${totalValue.toFixed(2)}</div>
                </div>
                <div style="margin-top: 10px; font-size: 14px; color: #666;">
                    –î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω: <strong>${minPrice.toFixed(2)} - ${maxPrice.toFixed(2)}</strong> | 
                    –†–∞–∑–±—Ä–æ—Å: <strong>${(maxPrice - minPrice).toFixed(2)}</strong>
                </div>
            `;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        function displayItems(items) {
            const container = document.getElementById('itemList');
            
            if (items.length === 0) {
                container.innerHTML = '<div class="loading">–ü—Ä–µ–¥–º–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="item">
                    ${item.imageUrl ? 
                        `<img src="${item.imageUrl}" alt="${item.collection}" class="item-image" onerror="this.style.display='none'">` : 
                        '<div class="item-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #999;">No img</div>'
                    }
                    <div class="item-info">
                        <div class="item-collection">${item.collection}</div>
                        <div class="item-quality">–ö–∞—á–µ—Å—Ç–≤–æ: ${item.quality}</div>
                        <div class="item-id">ID: ${item.itemId}</div>
                    </div>
                    <div class="item-price">
                        ${item.price.toFixed(2)} TON
                    </div>
                </div>
            `).join('');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
        function updateChart(items) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫
            if (currentChart) {
                currentChart.destroy();
            }

            if (items.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                return;
            }

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ü–µ–Ω–µ –¥–ª—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
            const priceGroups = {};
            items.forEach(item => {
                priceGroups[item.price] = (priceGroups[item.price] || 0) + 1;
            });

            const prices = Object.keys(priceGroups).map(Number).sort((a, b) => a - b);
            const counts = prices.map(price => priceGroups[price]);

            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: prices.map(p => p.toFixed(2)),
                    datasets: [{
                        label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –ø–æ —Ü–µ–Ω–∞–º',
                        data: counts,
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–Ω –Ω–∞ —Ä—ã–Ω–∫–µ'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `–¶–µ–Ω–∞: ${context.label} TON | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '–¶–µ–Ω–∞ (TON)'
                            },
                            ticks: {
                                maxTicksLimit: 20
                            }
                        }
                    }
                }
            });
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showMessage(elementId, message, type = 'loading') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<option value="">${message}</option>`;
        }

        function showLoading() {
            document.getElementById('stats').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';
            document.getElementById('itemList').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadCollections().then(() => {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π
                setTimeout(loadMarketData, 1000);
            });
        });
    </script>
</body>
</html>
